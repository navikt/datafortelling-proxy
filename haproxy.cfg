global
    maxconn 256

defaults
    mode http
    timeout connect 4000ms
    timeout client 10000ms
    timeout server 10000ms

listen http-in
    bind *:8080
    acl has_trailing_slash path_end /
    acl is_file path_end .gif .png .jpg .css .js .html
    http-request set-header Host "storage.googleapis.com"
    http-request set-path %[path,regsub(/$,)] if has_trailing_slash
    http-request set-path /data.knada.io%[path] if is_file
    http-request set-path /data.knada.io%[path]/index.html unless is_file
    server server "storage.googleapis.com":443 ssl verify none maxconn 32
